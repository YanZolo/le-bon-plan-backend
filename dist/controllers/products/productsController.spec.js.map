{"version":3,"sources":["../../../src/controllers/products/productsController.spec.ts"],"names":["productModel","ProductsController","jest","describe","it","expect","beforeEach","mock","findById","mockClear","productController","find","mockResolvedValue","result","getProducts","toEqual","title","getProduct","params","id","toHaveBeenCalledWith","undefined","actualError","error","message","status","name","save","fn","_id","price","mockImplementation","addProduct","body","toHaveBeenCalled","toHaveReturned","updateProduct","toBeCalled","req","spyOn","deleteProduct","deleteOne","toHaveBeenCalledTimes"],"mappings":"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","sourcesContent":["import productModel from '../../models/productModel.js';\nimport { ProductsController } from './productsController.js';\nimport { jest, describe, it, expect, beforeEach } from '@jest/globals';\nimport { Request } from 'express';\nimport mongoose from 'mongoose'\n\njest.mock('../../models/productModel');\n\ndescribe('productController', () => {\n  beforeEach(() => {\n    (productModel.findById as jest.Mock).mockClear();\n  });\n  describe('getProducts()', () => {\n    it('should return empty array', async () => {\n      // given\n      const productController = new ProductsController();\n      (productModel.find as jest.Mock).mockResolvedValue([]);\n      // when\n      const result = await productController.getProducts();\n      // then\n      expect(result).toEqual([]);\n    });\n  });\n\n  describe('getProduct()', () => {\n    it('should return a product from productModel', async () => {\n      // given\n      const productController = new ProductsController();\n      (productModel.findById as jest.Mock).mockResolvedValue([\n        {\n          title: 'toto'\n        }\n      ]);\n      // when\n      const result = await productController.getProduct({\n        params: { id: 'gjdkgjdsglksdjg' }\n      } as any);\n      // then\n      expect(result).toEqual([\n        {\n          title: 'toto'\n        }\n      ]);\n      expect(productModel.findById as jest.Mock).toHaveBeenCalledWith('gjdkgjdsglksdjg');\n    });\n\n    it('should throw product error not found', async () => {\n      // given\n      const productController = new ProductsController();\n      (productModel.findById as jest.Mock).mockResolvedValue(undefined);\n      // when\n      let actualError;\n      try {\n        await productController.getProduct({\n          params: { id: 'gjdkgjdsglksdjg' }\n        } as any);\n      } catch (error) {\n        actualError = error;\n      }\n      // then\n      expect(actualError.message).toEqual('Product Not Found');\n      expect(actualError.status).toEqual(404);\n      expect(actualError.name).toEqual('NOT_FOUND');\n    });\n  });\n\n  describe('addProduct()', () => {\n    it('should add a new product in database', async () => {\n      // given\n      const productController = new ProductsController();\n      const save = (jest.fn() as jest.Mock).mockResolvedValue({\n        _id: 'id',\n        price: 44,\n        title: 'product 123'\n      });\n      (productModel as jest.MockedFunction<any>).mockImplementation(() => {\n        return {\n          save\n        };\n      });\n      // when\n      const result = await productController.addProduct({\n        body: {\n          price: 44,\n          title: 'product 123'\n        }\n      } as Request<{price:number, title: string}>);\n      // then\n      expect(productModel).toHaveBeenCalledWith({\n        price: 44,\n        title: 'product 123'\n      });\n      expect(save).toHaveBeenCalled();\n      expect(save).toHaveReturned();\n      expect(result).toEqual({\n        _id: 'id',\n        price: 44,\n        title: 'product 123'\n      });\n    });\n  });\n\n  describe('updateProduct()', () => {\n    it('should update a product', async () => {\n      // given\n      const productController = new ProductsController();\n      (productModel.findById as jest.Mock).mockResolvedValue({\n        _id: 'some-id',\n        title: 'test updateProduct()',\n        price: 46\n      });\n      const save = (jest.fn() as jest.MockedFunction<any>).mockResolvedValue({\n        _id: 'some-id',\n        title: 'new test updateProduct()',\n        price: 47\n      });\n      (productModel as jest.MockedFunction<any>).mockImplementation(() => {\n        return {\n          save\n        };\n      });\n      const result = await productController.updateProduct({\n        params: { id: 'some-id' },\n        body: { title: 'new test updateProduct()', price: 47 }\n      } as Request<{id: string},any,{title:string, price:number}>);\n      // then\n      expect(productModel.findById).toHaveBeenCalledWith('some-id');\n      expect(save).toBeCalled();\n      expect(save).toHaveReturned();\n      expect(result).toEqual({\n        _id: 'some-id',\n        title: 'new test updateProduct()',\n        price: 47\n      });\n    });\n  });\n\n  describe('deleteProduct()', () => {\n    it('should delete a product', async () => {\n      // given\n      const req = {\n        params: { id: 'some_id_123' }\n      }\n\n      const productController = new ProductsController();\n      jest.spyOn(productController, 'getProduct').mockResolvedValue({\n        _id: 'some_id_123',\n        title: 'test deleteProduct()',\n        price: 99\n      } as any);\n\n      // when\n      const result = await productController.deleteProduct(req as Request<{id: string}>);\n      \n      // then\n      expect(productController.getProduct).toHaveBeenCalledWith(req);\n      expect(result).toEqual(undefined); \n      expect(productModel.deleteOne).toHaveBeenCalledTimes(1);\n      expect(productModel.deleteOne).toHaveBeenCalledWith({\n        _id: 'some_id_123'\n      });\n    });\n  });\n});\n"],"file":"productsController.spec.js"}