{"version":3,"sources":["../../../src/controllers/users/usersController.spec.ts"],"names":["userModel","UserController","jest","describe","it","expect","beforeEach","mock","findById","mockClear","userController","find","mockResolvedValue","result","getAllUsers","toEqual","username","getUser","params","id","toHaveBeenCalledWith","undefined","currentError","error","message","status","name","save","fn","_id","email","password","mockImplementation","addUser","body","toHaveBeenCalled","toHaveReturned","updateUser","toBeCalled","deleteUser","deleteOne","toBeCalledTimes"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,2BAAtB;AACA,SAASC,cAAT,QAA+B,sBAA/B;AACA,SAASC,IAAT,EAAeC,QAAf,EAAyBC,EAAzB,EAA6BC,MAA7B,EAAqCC,UAArC,QAAuD,eAAvD;AAGAJ,IAAI,CAACK,IAAL,CAAU,2BAAV;AAEAJ,QAAQ,CAAC,eAAD,EAAkB,MAAM;AAC9BG,EAAAA,UAAU,CAAC,MAAM;AACdN,IAAAA,SAAS,CAACQ,QAAX,CAAkCC,SAAlC;AACD,GAFS,CAAV;AAGAN,EAAAA,QAAQ,CAAC,eAAD,EAAkB,MAAM;AAC9BC,IAAAA,EAAE,CAAC,8BAAD,EAAiC,YAAY;AAE7C,YAAMM,cAAc,GAAG,IAAIT,cAAJ,EAAvB;AACCD,MAAAA,SAAS,CAACW,IAAX,CAA8BC,iBAA9B,CAAgD,EAAhD;AAEA,YAAMC,MAAM,GAAG,MAAMH,cAAc,CAACI,WAAf,EAArB;AAEAT,MAAAA,MAAM,CAACQ,MAAD,CAAN,CAAeE,OAAf,CAAuB,EAAvB;AACD,KARC,CAAF;AASD,GAVO,CAAR;AAWAZ,EAAAA,QAAQ,CAAC,WAAD,EAAc,MAAM;AAC1BC,IAAAA,EAAE,CAAC,wBAAD,EAA2B,YAAY;AAEvC,YAAMM,cAAc,GAAG,IAAIT,cAAJ,EAAvB;AACCD,MAAAA,SAAS,CAACQ,QAAX,CAAkCI,iBAAlC,CAAoD,CAClD;AACEI,QAAAA,QAAQ,EAAE;AADZ,OADkD,CAApD;AAMA,YAAMH,MAAM,GAAG,MAAMH,cAAc,CAACO,OAAf,CAAuB;AAC1CC,QAAAA,MAAM,EAAE;AAAEC,UAAAA,EAAE,EAAE;AAAN;AADkC,OAAvB,CAArB;AAIAd,MAAAA,MAAM,CAACQ,MAAD,CAAN,CAAeE,OAAf,CAAuB,CACrB;AACEC,QAAAA,QAAQ,EAAE;AADZ,OADqB,CAAvB;AAKAX,MAAAA,MAAM,CAACL,SAAS,CAACQ,QAAX,CAAN,CAA2BY,oBAA3B,CAAgD,UAAhD;AACD,KAnBC,CAAF;AAoBAhB,IAAAA,EAAE,CAAC,+BAAD,EAAkC,YAAY;AAE9C,YAAMM,cAAc,GAAG,IAAIT,cAAJ,EAAvB;AACCD,MAAAA,SAAS,CAACQ,QAAX,CAAkCI,iBAAlC,CAAoDS,SAApD;AAEA,UAAIC,YAAJ;;AACA,UAAI;AACF,cAAMZ,cAAc,CAACO,OAAf,CAAuB;AAC3BC,UAAAA,MAAM,EAAE;AAAEC,YAAAA,EAAE,EAAE;AAAN;AADmB,SAAvB,CAAN;AAGD,OAJD,CAIE,OAAOI,KAAP,EAAc;AACdD,QAAAA,YAAY,GAAGC,KAAf;AACD;;AAEDlB,MAAAA,MAAM,CAACiB,YAAY,CAACE,OAAd,CAAN,CAA6BT,OAA7B,CAAqC,gBAArC;AACAV,MAAAA,MAAM,CAACiB,YAAY,CAACG,MAAd,CAAN,CAA4BV,OAA5B,CAAoC,GAApC;AACAV,MAAAA,MAAM,CAACiB,YAAY,CAACI,IAAd,CAAN,CAA0BX,OAA1B,CAAkC,WAAlC;AACD,KAjBC,CAAF;AAkBD,GAvCO,CAAR;AAyCAZ,EAAAA,QAAQ,CAAC,WAAD,EAAc,MAAM;AAC1BC,IAAAA,EAAE,CAAC,iCAAD,EAAoC,YAAY;AAEhD,YAAMM,cAAc,GAAG,IAAIT,cAAJ,EAAvB;AACA,YAAM0B,IAAI,GAAGzB,IAAI,CAAC0B,EAAL,CAAQ,MAAM;AACzB,eAAO;AACLC,UAAAA,GAAG,EAAE,iBADA;AAELb,UAAAA,QAAQ,EAAE,cAFL;AAGLc,UAAAA,KAAK,EAAE,kBAHF;AAILC,UAAAA,QAAQ,EAAE;AAJL,SAAP;AAMD,OAPY,CAAb;AAQC/B,MAAAA,SAAD,CAAwCgC,kBAAxC,CAA2D,MAAM;AAC/D,eAAO;AACLL,UAAAA;AADK,SAAP;AAGD,OAJD;AAMA,YAAMd,MAAM,GAAG,MAAMH,cAAc,CAACuB,OAAf,CAAuB;AAC1CC,QAAAA,IAAI,EAAE;AACJlB,UAAAA,QAAQ,EAAE,cADN;AAEJc,UAAAA,KAAK,EAAE,kBAFH;AAGJC,UAAAA,QAAQ,EAAE;AAHN;AADoC,OAAvB,CAArB;AAQA1B,MAAAA,MAAM,CAACL,SAAD,CAAN,CAAkBoB,oBAAlB,CAAuC;AACrCJ,QAAAA,QAAQ,EAAE,cAD2B;AAErCc,QAAAA,KAAK,EAAE,kBAF8B;AAGrCC,QAAAA,QAAQ,EAAE;AAH2B,OAAvC;AAKA1B,MAAAA,MAAM,CAACsB,IAAD,CAAN,CAAaQ,gBAAb;AACA9B,MAAAA,MAAM,CAACsB,IAAD,CAAN,CAAaS,cAAb;AACA/B,MAAAA,MAAM,CAACQ,MAAD,CAAN,CAAeE,OAAf,CAAuB;AACrBc,QAAAA,GAAG,EAAE,iBADgB;AAErBb,QAAAA,QAAQ,EAAE,cAFW;AAGrBc,QAAAA,KAAK,EAAE,kBAHc;AAIrBC,QAAAA,QAAQ,EAAE;AAJW,OAAvB;AAMD,KAtCC,CAAF;AAuCD,GAxCO,CAAR;AA0CA5B,EAAAA,QAAQ,CAAC,eAAD,EAAkB,MAAM;AAC9BC,IAAAA,EAAE,CAAC,sBAAD,EAAyB,YAAY;AAErC,YAAMM,cAAc,GAAG,IAAIT,cAAJ,EAAvB;AACCD,MAAAA,SAAS,CAACQ,QAAX,CAAkCI,iBAAlC,CAAoD;AAClDiB,QAAAA,GAAG,EAAE,oBAD6C;AAElDb,QAAAA,QAAQ,EAAE,cAFwC;AAGlDc,QAAAA,KAAK,EAAE,WAH2C;AAIlDC,QAAAA,QAAQ,EAAE;AAJwC,OAApD;AAMA,YAAMJ,IAAI,GAAIzB,IAAI,CAAC0B,EAAL,EAAD,CAAwChB,iBAAxC,CAA0D;AACrEiB,QAAAA,GAAG,EAAE,oBADgE;AAErEb,QAAAA,QAAQ,EAAE,cAF2D;AAGrEc,QAAAA,KAAK,EAAE,WAH8D;AAIrEC,QAAAA,QAAQ,EAAE;AAJ2D,OAA1D,CAAb;AAMC/B,MAAAA,SAAD,CAAwCgC,kBAAxC,CAA2D,MAAM;AAC/D,eAAO;AACLL,UAAAA;AADK,SAAP;AAGD,OAJD;AAMA,YAAMd,MAAM,GAAG,MAAMH,cAAc,CAAC2B,UAAf,CAA0B;AAC7CnB,QAAAA,MAAM,EAAE;AAAEC,UAAAA,EAAE,EAAE;AAAN,SADqC;AAE7Ce,QAAAA,IAAI,EAAE;AACJlB,UAAAA,QAAQ,EAAE,cADN;AAEJc,UAAAA,KAAK,EAAE,WAFH;AAGJC,UAAAA,QAAQ,EAAE;AAHN;AAFuC,OAA1B,CAArB;AASA1B,MAAAA,MAAM,CAACsB,IAAD,CAAN,CAAaW,UAAb;AACAjC,MAAAA,MAAM,CAACsB,IAAD,CAAN,CAAaS,cAAb;AACA/B,MAAAA,MAAM,CAACQ,MAAD,CAAN,CAAeE,OAAf,CAAuB;AACrBc,QAAAA,GAAG,EAAE,oBADgB;AAErBb,QAAAA,QAAQ,EAAE,cAFW;AAGrBc,QAAAA,KAAK,EAAE,WAHc;AAIrBC,QAAAA,QAAQ,EAAE;AAJW,OAAvB;AAMD,KAtCC,CAAF;AAwCA5B,IAAAA,QAAQ,CAAC,cAAD,EAAiB,MAAM;AAC7BC,MAAAA,EAAE,CAAC,sBAAD,EAAyB,YAAY;AAErC,cAAMM,cAAc,GAAG,IAAIT,cAAJ,EAAvB;AAECD,QAAAA,SAAS,CAACQ,QAAX,CAAkCI,iBAAlC,CAAoD;AAClDiB,UAAAA,GAAG,EAAE,eAD6C;AAElDb,UAAAA,QAAQ,EAAE,oBAFwC;AAGlDc,UAAAA,KAAK,EAAE;AAH2C,SAApD;AAOA,cAAMjB,MAAM,GAAG,MAAMH,cAAc,CAAC6B,UAAf,CAA0B;AAC7CrB,UAAAA,MAAM,EAAE;AAAEC,YAAAA,EAAE,EAAE;AAAN;AADqC,SAA1B,CAArB;AAKAd,QAAAA,MAAM,CAACL,SAAS,CAACwC,SAAX,CAAN,CAA4BC,eAA5B,CAA4C,CAA5C;AACApC,QAAAA,MAAM,CAACL,SAAS,CAACwC,SAAX,CAAN,CAA4BpB,oBAA5B,CAAiD;AAC/CS,UAAAA,GAAG,EAAE;AAD0C,SAAjD;AAGAxB,QAAAA,MAAM,CAACQ,MAAD,CAAN,CAAeE,OAAf,CAAuBM,SAAvB;AACD,OArBC,CAAF;AAsBD,KAvBO,CAAR;AAwBD,GAjEO,CAAR;AAkED,CApKO,CAAR","sourcesContent":["import userModel from '../../models/userModel.js';\nimport { UserController } from './usersController.js';\nimport { jest, describe, it, expect, beforeEach } from '@jest/globals';\nimport { Request } from 'express';\n\njest.mock('../../models/userModel.js');\n\ndescribe('useController', () => {\n  beforeEach(() => {\n    (userModel.findById as jest.Mock).mockClear();\n  });\n  describe('getAllUsers()', () => {\n    it('should return an empty array', async () => {\n      // given\n      const userController = new UserController();\n      (userModel.find as jest.Mock).mockResolvedValue([]);\n      // when\n      const result = await userController.getAllUsers();\n      // then\n      expect(result).toEqual([]);\n    });\n  });\n  describe('getUser()', () => {\n    it('should return one user', async () => {\n      // given\n      const userController = new UserController();\n      (userModel.findById as jest.Mock).mockResolvedValue([\n        {\n          username: 'soso'\n        }\n      ]);\n      // when\n      const result = await userController.getUser({\n        params: { id: 'kjglmdfk' }\n      } as Request<{ id: string }>);\n      // then\n      expect(result).toEqual([\n        {\n          username: 'soso'\n        }\n      ]);\n      expect(userModel.findById).toHaveBeenCalledWith('kjglmdfk');\n    });\n    it(\"should throw 'User Not Found'\", async () => {\n      // GIVEN\n      const userController = new UserController();\n      (userModel.findById as jest.Mock).mockResolvedValue(undefined);\n      // WHEN\n      let currentError;\n      try {\n        await userController.getUser({\n          params: { id: 'kjjfdfdfdkf' }\n        } as Request<{ id: string }>);\n      } catch (error) {\n        currentError = error;\n      }\n      // THEN\n      expect(currentError.message).toEqual('User Not Found');\n      expect(currentError.status).toEqual(404);\n      expect(currentError.name).toEqual('NOT_FOUND');\n    });\n  });\n\n  describe('addUser()', () => {\n    it('should add new user in database', async () => {\n      // given\n      const userController = new UserController();\n      const save = jest.fn(() => {\n        return {\n          _id: 'some id addUser',\n          username: 'test addUser',\n          email: 'test@addUser.com',\n          password: 'test password'\n        };\n      });\n      (userModel as jest.MockedFunction<any>).mockImplementation(() => {\n        return {\n          save\n        };\n      });\n      // when\n      const result = await userController.addUser({\n        body: {\n          username: 'test addUser',\n          email: 'test@addUser.com',\n          password: 'test password'\n        }\n      } as Request<{ username: string; email: string }>);\n      // then\n      expect(userModel).toHaveBeenCalledWith({\n        username: 'test addUser',\n        email: 'test@addUser.com',\n        password: 'test password'\n      });\n      expect(save).toHaveBeenCalled();\n      expect(save).toHaveReturned();\n      expect(result).toEqual({\n        _id: 'some id addUser',\n        username: 'test addUser',\n        email: 'test@addUser.com',\n        password: 'test password'\n      });\n    });\n  });\n\n  describe('udpdateUser()', () => {\n    it('should update a user', async () => {\n      // given\n      const userController = new UserController();\n      (userModel.findById as jest.Mock).mockResolvedValue({\n        _id: 'some id updateUser',\n        username: 'old username',\n        email: 'old email',\n        password: 'old password'\n      });\n      const save = (jest.fn() as jest.MockedFunction<any>).mockResolvedValue({\n        _id: 'some id updateUser',\n        username: 'new username',\n        email: 'new email',\n        password: 'new password'\n      });\n      (userModel as jest.MockedFunction<any>).mockImplementation(() => {\n        return {\n          save\n        };\n      });\n      // when\n      const result = await userController.updateUser({\n        params: { id: 'some id updateUser' },\n        body: {\n          username: 'new username',\n          email: 'new email',\n          password: 'new password'\n        }\n      } as Request<{ id: string }, any, { username: string; email: string, password: string }>);\n      // then\n      expect(save).toBeCalled();\n      expect(save).toHaveReturned();\n      expect(result).toEqual({\n        _id: 'some id updateUser',\n        username: 'new username',\n        email: 'new email',\n        password: 'new password'\n      });\n    });\n\n    describe('deleteUser()', () => {\n      it('should delete a user', async () => {\n        // given\n        const userController = new UserController();\n\n        (userModel.findById as jest.Mock).mockResolvedValue({\n          _id: 'id deleteUser',\n          username: 'username to delete',\n          email: 'email to delete'\n        });\n\n        // when\n        const result = await userController.deleteUser({\n          params: { id: 'id deleteUser' }\n        } as Request<{ id: string }>);\n\n        // then\n        expect(userModel.deleteOne).toBeCalledTimes(1);\n        expect(userModel.deleteOne).toHaveBeenCalledWith({\n          _id: 'id deleteUser'\n        });\n        expect(result).toEqual(undefined);\n      });\n    });\n  });\n});\n"],"file":"usersController.spec.js"}